# ì„œë²„

### **ì£¼ì˜ !! SSAFY íŠ¹í™”í”„ë¡œì íŠ¸ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤(2022/09/21)**

## ì‚¬ìš© ê¸°ìˆ  ìŠ¤íƒ

- AWS EC2
- Docker
- Jenkins
- Nginx
- Letâ€™s Encrypt(certbot)
- SpringBoot
- Vue

### ì°¸ê³  ë§í¬

[[ì„œë²„ í™˜ê²½ ì„¤ì • ì „ ê³¼](https://www.notion.so/a1d39fc1932b4a8a94c588fc20f30c72)[ì •](https://github.com/hjs101/CICD_manual)(Django, React)](https://www.notion.so/Django-React-599c07df7fdd4291a7fe41b1f3b3e54e)

## 1. í™˜ê²½ ì„¤ì •

### 1.1 EC2 ì„œë²„ì— Docker ì„¤ì¹˜

ğŸ€ Ubuntu í™˜ê²½ì— Docker ì„¤ì¹˜

1.1.1 ì‚¬ì „ íŒ¨í‚¤ì§€ ì„¤ì¹˜

ë„ì»¤ ì„¤ì¹˜ë¥¼ ìœ„í•´ í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜

```jsx
ì„¤ì¹˜ ê°€ëŠ¥í•œ íŒ¨í‚¤ì§€ ë¦¬ìŠ¤íŠ¸ ìµœì‹ í™” (O), ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸ (X)
sudo apt update

sudo apt-get install -y ca-certificates \
    curl \
    software-properties-common \
    apt-transport-https \
    gnupg \
    lsb-release
```

íŒ¨í‚¤ì§€ ì„¤ëª…

- ca-certificates : SSL ê¸°ë°˜ ì•±ì´ SSL ì—°ê²° ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
- curl : ì„œë²„ì™€ í†µì‹ í•˜ê¸° ìœ„í•´ ì‚¬ìš©
- apt-transport-https : íŒ¨í‚¤ì§€ ê´€ë¦¬ìê°€ httpsë¥¼ í†µí•´ ë°ì´í„° ë° íŒ¨í‚¤ì§€ ì ‘ê·¼
- software-properties-common : PPA ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì œê±°
    - PPA( Personal Package Archive) : ê°œì¸ íŒ¨í‚¤ì§€ ì €ì¥ì†Œ
- gnupg : í†µì‹  ìƒ or ë°ì´í„° ì €ì¥í•  ë•Œ ë³´ì•ˆì„ ì§€í‚¤ëŠ” ë„êµ¬, ë°ì´í„°ë¥¼ ì•”í˜¸í™”í•˜ê³  ì „ì ì„œëª…ì„ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë©° ì•”í˜¸í™” ë„êµ¬ë¡œ ìœ ëª…í•œ PGPë¥¼ ì™„ë²½í•˜ê²Œ ëŒ€ì‹ í•  ìˆ˜ ìˆë‹¤.
    - [gnupg ì„¤ëª… ì°¸ê³ ì‚¬ì´íŠ¸](http://www.linuxlab.co.kr/docs/01-01-3.htm)
- lsb-release : ë¦¬ëˆ…ìŠ¤ ë°°í¬íŒ ì½”ë“œëª… í™•ì¸ ëª…ë ¹ì–´
    - [ì¶”ê°€ ì„¤ëª…](https://idchowto.com/%EB%A6%AC%EB%88%85%EC%8A%A4-%EB%B0%B0%ED%8F%AC%ED%8C%90-%EB%B2%84%EC%A0%84-%ED%99%95%EC%9D%B8-lsb_release/)
    

1.1.2 ë„ì»¤ ì„¤ì¹˜ë¥¼ ìœ„í•´ gpg Key ë‹¤ìš´

```jsx
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

echo \
    "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
    $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

íŒ¨í‚¤ì§€ ì„¤ëª…

- mkdir -p /etc/apt/keyrings
    - mkdir : ë””ë ‰í† ë¦¬(í´ë”) ìƒì„±
    - -p : ì˜µì…˜, í•„ìš”í•œ ê²½ìš° ìƒìœ„ ê²½ë¡œê¹Œì§€ ìƒì„±
    - /etc/apt/keyrings : ìƒì„± ê²½ë¡œ
- curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
    - ë„ì»¤ë¥¼ ì„¤ì¹˜í•˜ê¸° ìœ„í•´ gpg Keyë¥¼ ë‹¤ìš´ë°›ì•„ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” ë¦¬ëˆ…ìŠ¤ íŒ¨í‚¤ì§€ íˆ´ì´ í”„ë¡œê·¸ë¨ íŒ¨í‚¤ì§€ê°€ ìœ íš¨í•œì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì„¤ì¹˜ ì „ì— gpg í‚¤ë¥¼ í†µí•´ ê²€ì¦í•˜ëŠ” ê³¼ì •ì„ ê±°ì¹˜ê¸° ë•Œë¬¸ì— gpg í‚¤ë¥¼ ë°›ì•„ì•¼ í•œë‹¤ê³  í•©ë‹ˆë‹¤.
- echo
    - í™”ë©´ ì¶œë ¥ì„ ë‹´ë‹¹í•˜ëŠ” ëª…ë ¹ì–´
    - ex) echo hello
    - ì¶œë ¥ â‡’ hello
- tee
    - í‘œì¤€ ì…ë ¥ì—ì„œ ì½ì–´ í‘œì¤€ ì¶œë ¥ê³¼ íŒŒì¼ì— ì“°ëŠ” ëª…ë ¹ì–´
    - ex) `echo "hello" | tee OUTFILE`
    

1.1.3 ë„ì»¤ ì„¤ì¹˜

`apt update`ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ì£¼ê³ , ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ë„ì»¤ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.Â 

`docker-compose`ëŠ” ì¶”ê°€ë¡œ ì„¤ì¹˜í•©ë‹ˆë‹¤.(ì  í‚¨ìŠ¤ ì„¤ì¹˜í•  ë•Œ í¸í•˜ê²Œ í•˜ê¸° ìœ„í•´ ì”ë‹ˆë‹¤. ë‹¤ë¥¸ ì‚¬ìš©ë²•ë„ ìˆëŠ”ë° ì €ëŠ” ì´ë²ˆì—ëŠ” ì“°ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.)

```jsx
sudo apt update
sudo apt install docker-ce docker-ce-cli containerd.io docker-compose
```

## 1.2 ì  í‚¨ìŠ¤ ì„¤ì¹˜

### 1.2.1 docerk-compose ì´ìš© ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆ ìƒì„±

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ docker-compose.yml íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled.png)

docker-compose.yml íŒŒì¼

```jsx
version: '3'

services:
    jenkins:
        image: jenkins/jenkins:lts
        container_name: jenkins
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
            - /jenkins:/var/jenkins_home
        ports:
            - "9090:8080"
        privileged: true
        user: root
```

ìœ„ ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ê¸°í•©ë‹ˆë‹¤. ê° ë‹¨ì–´ì— ëŒ€í•œ ì„¤ëª…ì€ ê°„ë‹¨í•˜ê²Œë§Œ í•˜ê² ìŠµë‹ˆë‹¤.

- services : ì»¨í…Œì´ë„ˆ ì„œë¹„ìŠ¤
- jenkins : ì„œë¹„ìŠ¤ ì´ë¦„
- image : ì»¨í…Œì´ë„ˆ ìƒì„±ì‹œ ì‚¬ìš©í•  image, ì—¬ê¸°ì„œëŠ” jenkins/jenkins:lts ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©(jenkinsì˜ ltsë²„ì „ì„ ê°€ì ¸ì˜¨ë‹¤ëŠ” ëœ»)
- container_name : ì»¨í…Œì´ë„ˆ ì´ë¦„
- volumes : ê³µìœ  í´ë” ëŠë‚Œ, awsì˜ /var/run/docker.sockì™€ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ /var/run/docker.sockë¥¼ ì—°ê²°, /jenkins í´ë”ì™€ /var/jenkins_home í´ë”ë¥¼ ì—°ê²°.
- ports : í¬íŠ¸ ë§¤í•‘, awsì˜ 9090 í¬íŠ¸ì™€ ì»¨í…Œì´ë„ˆì˜ 8080 í¬íŠ¸ë¥¼ ì—°ê²°í•œë‹¤.
- privileged : ì»¨í…Œì´ë„ˆ ì‹œìŠ¤í…œì˜ ì£¼ìš” ìì›ì— ì—°ê²°í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê²ƒ ê¸°ë³¸ì ìœ¼ë¡œ Falseë¡œ í•œë‹¤ê³  í•œë‹¤.
- user : ì  í‚¨ìŠ¤ì— ì ‘ì†í•  ìœ ì € ê³„ì • (rootë¡œ í•  ê²½ìš° ê´€ë¦¬ì)

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%201.png)

ì´í›„ escë¥¼ ëˆ„ë¥¸ í›„ :wq ë¥¼ ì…ë ¥í•˜ì—¬ íŒŒì¼ì„ ì €ì¥í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%202.png)

`sudo docker-compose up -d`Â ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•´ì¤ë‹ˆë‹¤. 

ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë˜ê³  ëŒì•„ê°€ëŠ” ê²ƒì„ ë³´ë ¤ë©´ -d ë¥¼ ë¹¼ê³  ì…ë ¥í•´ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%203.png)

`sudo docker ps`Â ëª…ë ¹ì–´ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ì»¨í…Œì´ë„ˆê°€ ì˜¬ë¼ê°€ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 1.2.2 ì  í‚¨ìŠ¤ ê³„ì • ìƒì„± ë° í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%204.png)

ì„œë²„ ê³µì¸ IP:9090 í¬íŠ¸ë¡œ ì ‘ì†í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì  í‚¨ìŠ¤ ì‹œì‘ í™”ë©´ì´ ë‚˜íƒ€ë‚˜ê²Œ ë©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%205.png)

ì—¬ê¸°ì„œ ë§í•˜ëŠ” Administrator passwordëŠ”Â `sudo docker logs jenkins`Â ëª…ë ¹ì–´ë¥¼ í†µí•´ ìœ„ ì‚¬ì§„ì˜ ë¹¨ê°„ ë„¤ëª¨ ìƒì ì•ˆì˜ ê°’ì„ ì…ë ¥í•´ì¤ë‹ˆë‹¤.

ë‹¤ìŒìœ¼ë¡œ ë‘ ê°œì˜ ë²„íŠ¼ ì¤‘Â `Install suggested plugins`ë¥¼ í´ë¦­í•´ì¤ë‹ˆë‹¤.(ê¸°ë³¸ í”ŒëŸ¬ê·¸ì¸ ìë™ ì„¤ì¹˜ ëŠë‚Œ, ë‹¤ë¥¸ ë²„íŠ¼ì€ ì‚¬ìš©ì ì§€ì • í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ ê°™ì€ ëŠë‚Œì…ë‹ˆë‹¤.)

ğŸ’£ ì €ëŠ” Pipeline ê´€ë ¨ í”ŒëŸ¬ê·¸ì¸ 3ê°€ì§€ê°€ ë‹¤ìš´ë¡œë“œ ë˜ì§€ ì•Šì•˜ëŠ”ë° í° ë¬¸ì œëŠ” ì—†ì—ˆìŠµë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%206.png)

ì´ê²ƒ ì €ê²ƒ í”ŒëŸ¬ê·¸ì¸ë“¤ì´ ì„¤ì¹˜ë˜ëŠ” ëª¨ìŠµì…ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%207.png)

ì  í‚¨ìŠ¤ ê³„ì • ìƒì„± formì…ë‹ˆë‹¤. ì ë‹¹íˆ ì…ë ¥í•˜ê³ Â `Save and Continue`Â ë²„íŠ¼ì„ ëˆŒëŸ¬ì¤ë‹ˆë‹¤.

ì´í›„Â `Save and Finish`,Â `Start using Jenkins`Â ë²„íŠ¼ì„ ì´ì–´ì„œ ëˆŒëŸ¬ ì  í‚¨ìŠ¤ë¥¼ ì‹œì‘í•´ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%208.png)

ì  í‚¨ìŠ¤ ì‹œì‘ ë©”ì¸í™”ë©´ì…ë‹ˆë‹¤. í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ë¥¼ ìœ„í•´ jenkins ê´€ë¦¬ íƒ­ì„ í´ë¦­í•´ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%209.png)

í”ŒëŸ¬ê·¸ì¸ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2010.png)

ë¨¼ì € ì„¤ì¹˜ ê°€ëŠ¥ íƒ­ìœ¼ë¡œ íƒ­ì„ ë³€ê²½í•´ì£¼ê³ , ê²€ìƒ‰ì–´ì—Â `gitlab`ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤.

ê·¸ í›„, ë°‘ì¤„ ì¹œ í”ŒëŸ¬ê·¸ì¸ë“¤ì„ ì²´í¬í•˜ê³ ,Â `install witout restart`Â ë²„íŠ¼ì„ í´ë¦­í•´ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2011.png)

ê°™ì€ ë°©ì‹ìœ¼ë¡œ Docker ê´€ë ¨ í”ŒëŸ¬ê·¸ì¸ë„ ì„¤ì¹˜í•´ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2012.png)

ë§ˆì§€ë§‰ìœ¼ë¡œ SSH ì—°ê²° ê´€ë ¨ í”ŒëŸ¬ê·¸ì¸ê¹Œì§€ ì„¤ì¹˜í•˜ê² ìŠµë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2013.png)

ëª¨ë‘ ì„¤ì¹˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

### 1.2.3 ì  í‚¨ìŠ¤ í”„ë¡œì íŠ¸ ìƒì„± Webhook ì„¤ì •, ìë™ ë¹Œë“œ í…ŒìŠ¤íŠ¸

ì´ì œ, ì  í‚¨ìŠ¤ì—ì„œ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê³ , ê¹ƒë©ê³¼ WebHookìœ¼ë¡œ ì—°ê²°í•˜ì—¬ ìë™ìœ¼ë¡œ ë¹Œë“œë¥¼ ì§„í–‰í•˜ëŠ” ê²ƒì„ í…ŒìŠ¤íŠ¸í•˜ê² ìŠµë‹ˆë‹¤.

ğŸ€ **ê¹ƒë© Repo ìƒì„±**

ê¹ƒë© ë ˆí¬ì§€í† ë¦¬ ìƒì„± ë¶€ë¶„ì€ ëª¨ë‘ ì˜ ì•Œê³  ìˆì„ ê±°ë¼ê³  ìƒê°í•˜ì—¬ ìŠ¤í‚µí•˜ê³ , ì œê°€ êµ¬ì„±í•œ ë ˆí¬ì§€í† ë¦¬ê°€ ì–´ë–»ê²Œ ë˜ì–´ìˆëŠ”ì§€ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…ë§Œ í•˜ê² ìŠµë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2014.png)

ì—¬ê¸°ì„œëŠ” SpringBoot ì™€ Vueë¥¼ ì´ìš©í•˜ì—¬ ë°°í¬ë¥¼ ì§„í–‰í•  ê²ƒì´ê¸° ë•Œë¬¸ì— í´ë”ë¡œ êµ¬ë¶„ì§€ì–´ ê°ê° SpringBoot, Vue í”„ë¡œì íŠ¸ë¥¼ ì„¤ì¹˜í•´ë‘ì—ˆìŠµë‹ˆë‹¤.

`testproject`ëŠ” SpringBoot í”„ë¡œì íŠ¸,Â `testproject_react`ëŠ” Vue  í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

ğŸ’£ ìº¡ì³ëœ ì´ë¯¸ì§€ ë‚´ì˜ í´ë” ì´ë¦„ê³¼ ì„¤ëª…ì´ ë‹¤ë¥¸ ì´ìœ ëŠ” ì œê°€ ì°¸ê³ í•œ ì‚¬ì´íŠ¸ì˜ ìº¡ì³ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ğŸ€ **ì  í‚¨ìŠ¤ í”„ë¡œì íŠ¸ ìƒì„±**

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2015.png)

ì  í‚¨ìŠ¤ ë©”ì¸í˜ì´ì§€ì—ì„œÂ `ìƒˆë¡œìš´ item`Â ì„ í´ë¦­í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2016.png)

í”„ë¡œì íŠ¸ ì´ë¦„ì€Â `deploytest`,Â `Freestyle project`ë¥¼ í´ë¦­í•˜ê³ Â `OK`Â ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2017.png)

`ì†ŒìŠ¤ì½”ë“œ ê´€ë¦¬`Â íƒ­ì„ í´ë¦­í•˜ê³ , Noneë¡œ ë˜ì–´ìˆëŠ” ê²ƒì„ git ë¼ë””ì˜¤ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì•„ë˜ì— Formì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2018.png)

`Repository URL`ì—ëŠ” ì‹¸í”¼ê¹ƒ ë ˆí¬ì§€í† ë¦¬ URLì„ ì…ë ¥í•´ì¤ë‹ˆë‹¤. ìœ„ ì‚¬ì§„ì²˜ëŸ¼ ì—ëŸ¬ ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚˜ëŠ” ê²ƒì´ ì§€ê¸ˆ ë‹¨ê³„ì—ì„œëŠ” ì •ìƒì…ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2019.png)

`Credentials`ì—ì„œ,Â `add`Â ->Â `jenkins`ë¥¼ í´ë¦­í•´ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2020.png)

- Username : ì‹¸í”¼ê¹ƒ ì•„ì´ë””
- Password : ì‹¸í”¼í‚· ë¹„ë°€ë²ˆí˜¸ ( ì•ˆëœë‹¤ë©´ ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸)
- ID : Credential êµ¬ë³„í•  ì•„ë¬´ í…ìŠ¤íŠ¸ ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤.

ìœ„ ë‚´ìš© ì…ë ¥í•˜ê³ Â `Add`Â ë²„íŠ¼ í´ë¦­í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2021.png)

`Credentials`ì—ì„œ ì´ì œ ë§Œë“¤ì–´ì§„Â `Credential`ì„ ì„ íƒí–ˆì„ ë•Œ ì˜¤ë¥˜ë©”ì‹œì§€ê°€ ì‚¬ë¼ì§€ë©´ ì„±ê³µì…ë‹ˆë‹¤.

ğŸ’£ ì €ëŠ” ê³„ì • ì¸ì¦ì´ ìœ„ì˜ ë°©ë²•ìœ¼ë¡œ ë˜ì§€ ì•Šì•„ ë‹¤ìŒ ë°©ë²•ìœ¼ë¡œ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.

ğŸ’£ ì˜¤ë¥˜ ë©”ì„¸ì§€ê°€ ì‚¬ë¼ì§€ì§€ ì•ŠëŠ” ë¶„ë§Œ ì§„í–‰í•˜ì‹œë©´ ë˜ê² ìŠµë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2022.png)

ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ì˜ ê¹ƒë©ìœ¼ë¡œ ë“¤ì–´ê°€ ì¢Œì¸¡ Settings â†’ Access Tokens ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2023.png)

Token name : ìƒì„±ë  í† í° ì´ë¦„ ì§€ì •( ì•„ë¬´ê±°ë‚˜ ì…ë ¥)

Expiration date :  í† í° ë§Œë£Œ ë‚ ì§œ ì§€ì • ( EC2 ì„œë²„ ë°˜ë‚©ë‚  or ì›í•˜ëŠ” ë‚ )

Select a role : Maintainer ì„ íƒ

Select scopes : ëª¨ë‘ ì„ íƒ

ğŸ€ğŸ€ğŸ€**ì´í›„ [í† í° ìƒì„±] ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í† í°( Your New Personal Access Token)ì´ ìƒì„±ë©ë‹ˆë‹¤.** 

ğŸ€ğŸ€ğŸ€**ìƒì„±ëœ í† í°ì€ ìƒì„± ë‹¹ì‹œ 1ë²ˆë§Œ ë³´ì—¬ì£¼ê¸° ë•Œë¬¸ì— ê¼­ ë³µì‚¬í•˜ì…”ì„œ ì €ì¥í•´ë‘ì…”ì•¼í•©ë‹ˆë‹¤.**

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2024.png)

ë‹¤ì‹œ ì  í‚¨ìŠ¤ë¡œ ëŒì•„ê°€ ID, Password(ìƒì„±ëœ token)ë¥¼ ì…ë ¥í•´ì„œ ì¸ì¦ì„ ì‹œë„í•©ë‹ˆë‹¤.

ğŸ€[ì  í‚¨ìŠ¤ ì´ë™](https://www.notion.so/8517c03771dc466cbe472774aea3bc4b)

ğŸ’£ê³„ì • ì¸ì¦ ë°©ë²• ë§ˆë¬´ë¦¬

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2025.png)

ë‹¤ìŒì€ ë¹Œë“œ ìœ ë°œ íƒ­ì…ë‹ˆë‹¤. ë¹Œë“œ ìœ ë°œ íƒ­ì—ì„œëŠ” ë¨¼ì € ë°‘ì¤„ ì¹œ ë¶€ë¶„ì˜ ì²´í¬ë°•ìŠ¤ë¥¼ ì²´í¬í•´ì¤ë‹ˆë‹¤. ê·¸ í›„ ìƒê¸°ëŠ” ê³ ê¸‰ ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2026.png)

ê·¸ í›„ ì¡°ê¸ˆ ìŠ¤í¬ë¡¤ì„ ë‚´ë ¤Â `Secret token`ì„ ì°¾ì•„ Generate ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì‚¬ì§„ê³¼ ê°™ì´ í† í°ì´ ìƒì„±ë©ë‹ˆë‹¤. ì´ í† í°ì€ Gitlabê³¼ WebHookì„ ì—°ê²°í•  ë•Œ ì‚¬ìš©ë˜ë‹ˆ ì €ì¥í•´ë‘¡ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2027.png)

ë‹¤ìŒì€ Build íƒ­ì…ë‹ˆë‹¤.Â `Add build step`ë¥¼ í´ë¦­í•˜ê³ ,Â `Execute Shell`ì„ ì„ íƒí•´ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2028.png)

ë‹¤ìŒê³¼ ê°™ì´ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆëŠ” ì¹¸ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. 

ì¼ë‹¨ ì—°ê²°ë§Œ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— pwd ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ê² ìŠµë‹ˆë‹¤.

ì—¬ê¸°ê¹Œì§€ ëª¨ë‘ ì™„ë£Œí–ˆë‹¤ë©´ ì €ì¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì €ì¥í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2029.png)

ì €ì¥ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìœ„ ì‚¬ì§„ì²˜ëŸ¼ í”„ë¡œì íŠ¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤. ì¼ë‹¨Â `ì§€ê¸ˆ ë¹Œë“œ`
Â ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ì  í‚¨ìŠ¤ ìˆ˜ë™ ë¹Œë“œë¥¼ ì§„í–‰í•´ë´…ë‹ˆë‹¤. ì•„ë˜ ë°‘ì¤„ì²˜ëŸ¼ ì™„ë£Œ í‘œì‹œê°€ ëœ¨ë©´ ì„±ê³µí•œ ê²ƒì…ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2030.png)

ë¹Œë“œ íˆìŠ¤í† ë¦¬ì—ì„œ,Â `Console Output`ì— ë“¤ì–´ê°€ë³´ê² ìŠµë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2031.png)

ë¹Œë“œì— ì„±ê³µí•œ console ì°½ì…ë‹ˆë‹¤. ì…ë ¥í•´ë‘ì—ˆë˜ ëª…ë ¹ì–´ pwdë„ ì˜ ì‘ë™í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ€ **ê¹ƒë© WebHook ì—°ê²°**

ë‹¤ìŒì€ ì‹¸í”¼ê¹ƒ ë ˆí¬ì§€í† ë¦¬ì™€ ì  í‚¨ìŠ¤ë¥¼Â `WebHook`ìœ¼ë¡œ ì—°ê²°í•˜ì—¬ ìë™ ë¹Œë“œë¥¼ ì§„í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2032.png)

ë°°í¬í•  í”„ë¡œì íŠ¸ê°€ ìˆëŠ” ê¹ƒë©Â `Repository`ì—ì„œ ë°‘ì¤„ì¹œ ìœ„ì¹˜ë¡œÂ `WebHooks`Â í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2033.png)

URLì—ëŠ”Â `http://ë°°í¬ì„œë²„ê³µì¸IP:9090/project/ìƒì„±í•œjenkinsí”„ë¡œì íŠ¸ì´ë¦„/`ì„ ì…ë ¥í•´ì¤ë‹ˆë‹¤.

Secret tokenì—ëŠ” ì•„ê¹Œ ìœ„ì—ì„œ ì  í‚¨ìŠ¤ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•  ë•Œ ì €ì¥í•´ë‘” ê°’ì„ ì…ë ¥í•©ë‹ˆë‹¤.

ë¹Œë“œ ìœ ë°œ Triggerìœ¼ë¡œ,Â `Push events, Merge request events`ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ëŒ€ìƒ BranchëŠ” masterìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

ì™„ë£Œí–ˆë‹¤ë©´ Add Webhook ë²„íŠ¼ì„ ëˆŒëŸ¬ webhookì„ ìƒì„±í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2034.png)

WebHookì„ ìƒì„±í•˜ê³  ë‚˜ë©´ ë¹Œë“œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ìƒì„±ëœ WebHookì—ì„œ testë¥¼ ëˆ„ë¥´ê³ , Push eventsë¥¼ ì„ íƒí•´ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2035.png)

ì‘ë‹µì´ ì˜ ë„˜ì–´ì˜¨ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (code 200)

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2036.png)

ì  í‚¨ìŠ¤ì—ì„œë„ ì •ìƒì ìœ¼ë¡œ ë¹Œë“œê°€ ìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ˜†Â ì—¬ê¸°ê¹Œì§€ ì™„ë£Œí–ˆìœ¼ë©´ ì´ì œÂ `Jenkins`ì™€Â `Gitlab`ì´ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤! ì—°ê²°ëœÂ `Gitlab`ì˜Â `master branch`ì— ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´, ì  í‚¨ìŠ¤ì—ì„œëŠ” ë¹Œë“œë¥¼ ìˆ˜í–‰í•˜ê²Œ ë©ë‹ˆë‹¤!

### 1.2.4 ì  í‚¨ìŠ¤ì™€ ì—°ê²°ëœ gitlab í”„ë¡œì íŠ¸ë¡œ ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œí•˜ê¸°

ì  í‚¨ìŠ¤ì—ì„œ ë„ì»¤ ë¹Œë“œë¥¼ í•˜ê¸° ìœ„í•´ì„œëŠ” ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆ ì•ˆì— ë„ì»¤ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤. ë„ì»¤ ì„¤ì¹˜ ë°©ë²•ì€ Ec2ì— ë„ì»¤ë¥¼ ì„¤ì¹˜í•  ë•Œì™€ ë™ì¼í•˜ê²Œ ì§„í–‰í•©ë‹ˆë‹¤.

ë¨¼ì € ì  í‚¨ìŠ¤ bash shellì— ì ‘ê·¼í•´ë³´ê² ìŠµë‹ˆë‹¤. ëª…ë ¹ì–´ëŠ”Â `sudo docker exec -it jenkins bash`Â ì…ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2037.png)

ì •ìƒì ìœ¼ë¡œ ì ‘ì†ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ í™”ë©´ì´ ë©ë‹ˆë‹¤. ì´ì œ ì´ í™˜ê²½ì— dockerë¥¼ ë‹¤ì‹œ ì„¤ì¹˜í•˜ë„ë¡ í•©ë‹ˆë‹¤.

ğŸ’£ **AWS EC2 ì„œë²„ì—ì„œì˜ ë„ì»¤ ì„¤ì¹˜ì™€ ê°™ê¸° ë•Œë¬¸ì— íŒ¨í‚¤ì§€ ì„¤ëª…ì€ ìƒëµí•˜ê² ìŠµë‹ˆë‹¤.**

ğŸ€ ì‚¬ì „ íŒ¨í‚¤ì§€ ì„¤ì¹˜

```jsx
apt update
apt-get install -y ca-certificates \
    curl \
    software-properties-common \
    apt-transport-https \
    gnupg \
    lsb-release
```

ë£¨íŠ¸ê³„ì •ìœ¼ë¡œ ì ‘ì†ë˜ì–´ìˆê¸° ë•Œë¬¸ì—, ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œëŠ” ëª…ë ¹ì–´ì— sudoë¥¼ ì§€ì›Œì•¼í•©ë‹ˆë‹¤.

ğŸ€ gpg í‚¤ ë‹¤ìš´ë¡œë“œ

```jsx
mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/debian/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg

echo \
    "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \
    $(lsb_release -cs) stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null
```

ì  í‚¨ìŠ¤ì— gpg í‚¤ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ì„ ë•Œì˜ ë³€ê²½ì‚¬í•­ì…ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2038.png)

ê¸°ì¡´ ë§í¬ì—ì„œ ì œê³µí•œ ë°©ì‹ì€Â `ubuntu os`ì— ëŒ€í•œÂ `gpg`Â í‚¤ë¥¼ ë‹¤ìš´ë¡œë“œ í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì—, ì´ë¥¼Â `debian`ìœ¼ë¡œ ë°”ê¾¸ì–´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

ì´ë¥¼ ë°”ê¾¸ì§€ ì•Šìœ¼ë©´ íŒ¨í‚¤ì§€ë¥¼ ì°¾ì§€ ëª»í•˜ëŠ” ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.

ê¸°ì¡´ ëª…ë ¹ì–´ì—ì„œÂ `ubuntu`ë¡œ ë˜ì–´ìˆëŠ” ë¶€ë¶„ì„Â `debian`ìœ¼ë¡œ ë°”ê¾¸ì–´ì£¼ë©´ í•´ê²°ë©ë‹ˆë‹¤.

ğŸ€ **ë„ì»¤ ì„¤ì¹˜**

```jsx
apt update
apt install docker-ce docker-ce-cli containerd.io docker-compose
```

ì—¬ê¸°ê¹Œì§€ ì§„í–‰í•˜ë©´Â `Jenkins Container`ì—ë„Â `Docker`ê°€ ì„¤ì¹˜ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ€ ****í”„ë¡œì íŠ¸ì— DockerFile ì‘ì„±****

ì´ì œ ê¹ƒë©ì˜ ê° í”„ë¡œì íŠ¸ í´ë”ì— DockerFileì„ ë§Œë“¤ì–´ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì£¼ê² ìŠµë‹ˆë‹¤.

SpringBoot Project DockerFile

```jsx
FROM openjdk:11
WORKDIR /var/jenkins_home/workspace/deploytest/testproject
COPY build/libs/percast-0.0.1-SNAPSHOT.jar app.jar
ENTRYPOINT ["java","-jar","app.jar"]
```

`SpringBoot DockerFile`ì—ì„œëŠ”Â `openjdk:11`Â ì´ë¯¸ì§€ë¥¼ ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¡œ ë‘ê³ ,Â 

ì‘ì—… ê²½ë¡œë¥¼ `gitlabì˜ springboot í´ë”`  ë¡œ ì§€ì •í•´ì¤ë‹ˆë‹¤.

ë¹Œë“œëœ jar íŒŒì¼ì„ app.jarë¡œ ë³µì‚¬í•œ ë’¤

`ENTRYPOINT` ëª…ë ¹ì–´ë¥¼ í†µí•´ ì‹¤í–‰í•©ë‹ˆë‹¤. 

Vue Project DockerFile

```jsx
FROM node:16.15.0 as build-stage
WORKDIR /var/jenkins_home/workspace/deploytest/testproject_vue
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
FROM nginx:stable-alpine as production-stage

COPY --from=build-stage /var/jenkins_home/workspace/deploytest/testproject_vue/build /usr/share/nginx/html
#COPY --from=build-stage /var/jenkins_home/workspace/deploytest/testproject_vue/deploy_conf/nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g","daemon off;"]
```

ê°„ë‹¨ ëª…ë ¹ì–´ ì„¤ëª…

- FROM : ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¥¼ ì§€ì •
- WORKDIR : ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
- COPY : íŒŒì¼ ë³µì‚¬ <Host íŒŒì¼ ê²½ë¡œ> <Docker ì´ë¯¸ì§€ íŒŒì¼ ê²½ë¡œ>
- RUN : ëª…ë ¹ ì‹¤í–‰
- CMD ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ëª…ë ¹
- EXPORT : í¬íŠ¸ ìµìŠ¤í¬íŠ¸

`Vue DockerFile`ì—ì„œëŠ” ë¨¼ì €Â `node:16.15.0`Â ì´ë¯¸ì§€ë¥¼ ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¡œ ë‘¡ë‹ˆë‹¤. asÂ `build-stage`ëŠ” ì´ë¯¸ì§€ë¥¼ ì§€ì¹­í•˜ëŠ” ë³„ëª…ì„ ë§í•©ë‹ˆë‹¤.

ê·¸ í›„Â `package*.json`ì— ë“±ë¡ë˜ì–´ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„Â `npm install`ìœ¼ë¡œ ì„¤ì¹˜í•˜ê³ , í”„ë¡œì íŠ¸ í´ë”ë¥¼ ì´ë¯¸ì§€ì— ë³µì‚¬,Â `npm run build`ë¥¼ í†µí•´ buildí´ë”ì— ë¹Œë“œí•œ í”„ë¡œì íŠ¸(static íŒŒì¼)ê°€ ì €ì¥ë©ë‹ˆë‹¤.

ì‹¤ì œ ì»¨í…Œì´ë„ˆë¡œ ìƒì„±ë˜ëŠ” ê±´ ë‹¤ìŒ ì´ë¯¸ì§€ì¸ë°ìš”,Â `nginx:stable-alpine`Â ì´ë¯¸ì§€ë¥¼ ë² ì´ìŠ¤ë¡œ ì„¤ì •í•˜ê³ , COPYì˜ ì˜µì…˜ìœ¼ë¡œÂ `--from=build-stage`Â ë¥¼ í†µí•´ ì•„ê¹Œ ë¹Œë“œí–ˆë˜ íŒŒì¼ë“¤ì„ nginxì˜ ì„œë¹„ìŠ¤ í´ë”ì¸Â `/usr/share/nginx/html`ìœ¼ë¡œ ë³µì‚¬í•©ë‹ˆë‹¤.

ê·¸ í›„ 80í¬íŠ¸ë¡œ ìµìŠ¤í¬íŒ… í•˜ê³  CMDë¥¼ í†µí•´ nginxë¥¼ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰í•˜ëŠ” ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

âœ¨Â Reactì˜ ê²½ìš° npm run buildë¥¼ í–ˆì„ ë•Œ ìƒì„±ë˜ëŠ” í´ë”ê°€ distê°€ ì•„ë‹Œ buildì´ë¯€ë¡œ í´ë”ëª…ì— ì£¼ì˜í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤!

Vue ë„ì»¤íŒŒì¼ì—ì„œ #ìœ¼ë¡œ ì£¼ì„ì²˜ë¦¬í•œ ë¶€ë¶„ì€ nginx ì„¤ì •ì— ì‚¬ìš©ë˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤. ë’¤ì—ì„œ nginx ì„¤ì •í•  ë•Œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

í”„ë¡œì íŠ¸ì˜ ë„ì»¤ íŒŒì¼ ì„¤ì •ì€ ì´ì œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë‹¤ìŒì€ ì  í‚¨ìŠ¤ì—ì„œ ì´ ë„ì»¤íŒŒì¼ì„ ì´ìš©í•´ì„œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ë„ë¡ í•´ë³´ê² ìŠµë‹ˆë‹¤.

ğŸ€ ****ì  í‚¨ìŠ¤ì—ì„œ DockerFile ì´ìš© ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±****

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2039.png)

ì  í‚¨ìŠ¤ í”„ë¡œì íŠ¸ í˜ì´ì§€ì—ì„œ, êµ¬ì„± ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2040.png)

ê·¸ëŸ¼ ì•„ê¹Œ í”„ë¡œì íŠ¸ ìƒì„±í•  ë•Œì˜ ì°½ê³¼ ë¹„ìŠ·í•œ ì°½ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. Build íƒ­ìœ¼ë¡œ ì´ë™í•˜ê³ , ì•„ê¹Œ í”„ë¡œì íŠ¸ ìƒì„±í•  ë•Œ pwdë¡œ ì ì–´ë‘ì—ˆë˜ ëª…ë ¹ì–´ë¥¼ ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ë°”ê¾¸ì–´ì¤ë‹ˆë‹¤.

ğŸ’£ **ìº¡ì³ì™€ ì½”ë“œì˜ í´ë” ìœ„ì¹˜ê°€ ë‹¤ë¥¸ ì´ìœ ëŠ” ìœ„ ìº¡ì³ëŠ” ì œê°€ ì°¸ê³ í•œ ì‚¬ì´íŠ¸ì´ê³  ì•„ë˜ ì½”ë“œëŠ” ì œ ì‹¤ì œ ì½”ë“œ ê¸°ì¤€ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. í´ë” ìœ„ì¹˜, ì´ë¦„ì€ ì‚¬ìš©í•˜ì‹œëŠ” ë¶„ì˜ ìƒí™©ì— ë§ê²Œ ë³€ê²½í•˜ì‹œë©´ ë˜ê² ìŠµë‹ˆë‹¤.**

```jsx
docker image prune -a --force
mkdir -p /var/jenkins_home/images_tar
cd /var/jenkins_home/workspace/deploytest/testproject_vue/
docker build -t vue .
docker save vue > /var/jenkins_home/images_tar/vue.tar

cd /var/jenkins_home/workspace/deploytest/testproject/
docker build -t springboot .
docker save springboot > /var/jenkins_home/images_tar/springboot.tar

ls /var/jenkins_home/images_tar
```

ìœ„ ëª…ë ¹ì–´ì— ëŒ€í•œ ê°œë³„ ì„¤ëª…

- docker image prune -a --force : ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ ì‚­ì œ
- mkdir -p /var/jenkins_home/images_tar : ë„ì»¤ ì´ë¯¸ì§€ ì••ì¶•íŒŒì¼ì„ ì €ì¥í•  í´ë” ìƒì„±
- cd /var/jenkins_home/workspace/deploytest/testproject_vue : í•´ë‹¹ ê²½ë¡œë¡œ ì´ë™(vue í”„ë¡œì íŠ¸ í´ë”)
- docker build -t vue . : ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ(Vue í”„ë¡œì íŠ¸)
- docker save vue > /var/jenkins_home/images_tar/vue.tar : ë„ì»¤ ì´ë¯¸ì§€ë¥¼ vue.tarë¡œ ì••ì¶•í•˜ì—¬ ìœ„ì—ì„œ ìƒì„±í•œ í´ë”ì— ì €ì¥
- cd /var/jenkins_home/workspace/deploytest/testproject/ : í•´ë‹¹ ê²½ë¡œë¡œ ì´ë™(springboot í”„ë¡œì íŠ¸ í´ë”)
- docker build -t springboot . : ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ(springboot í”„ë¡œì íŠ¸)
- docker save springboot > /var/jenkins_home/images_tar/springboot.tar : ë„ì»¤ ì´ë¯¸ì§€ë¥¼ springboot.tarë¡œ ì••ì¶•í•˜ì—¬ ìœ„ì—ì„œ ìƒì„±í•œ í´ë”ì— ì €ì¥
- ls /var/jenkins_home/images_tar : í•´ë‹¹ í´ë”ì— ìˆëŠ” íŒŒì¼ ëª©ë¡ ì¶œë ¥(ì˜ ì••ì¶•ë˜ì–´ ì €ì¥ë˜ì—ˆëŠ”ì§€ í™•ì¸)

ì´í›„ ì €ì¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2041.png)

ê·¸ í›„ ì§€ê¸ˆ ë¹Œë“œ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¹Œë“œí•´ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2042.png)

ë‹¤ìŒê³¼ ê°™ì´ ë‚˜ì˜¤ë©´ ë¹Œë“œ ì„±ê³µì…ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2043.png)

ìƒì„±ëœ 2ê°œì˜ tar íŒŒì¼ì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2044.png)

ì´ ê¸€ ì´ˆë°˜ë¶€ì˜ ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆ ìƒì„±í•  ë•Œì˜Â `docker-compose.yml`Â íŒŒì¼ì´ ê¸°ì–µ ë‚˜ì‹œë‚˜ìš”? ê·¸ ë•Œ ê³µìœ  í´ë”ë¡œ awsì˜Â `/jenkins`ì™€Â `/var/jenkins_home`ë¥¼ ì—°ê²°í–ˆì—ˆìŠµë‹ˆë‹¤.

ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆ ì•ˆì˜Â `/var/jenkins_home/images_tar`Â í´ë” ì•ˆì— 2ê°œì˜ tar íŒŒì¼ì´ ìƒì„±ë˜ì–´ìˆê³ , í´ë”ë¥¼ ê³µìœ í•˜ëŠ” EC2ì˜Â `/jenkins/images_tar`ì—ë„ ë˜‘ê°™ì´ 2ê°œì˜ tar íŒŒì¼ì´ ìƒì„±ë˜ì–´ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ˜†Â ì—¬ê¸°ê¹Œì§€ ì™„ë£Œí–ˆìœ¼ë©´ ì  í‚¨ìŠ¤ì—ì„œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ì—¬ tar ì••ì¶•íŒŒì¼ë¡œ ìƒì„±í•˜ëŠ” ë¶€ë¶„ê¹Œì§€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!

### 1.2.5 ****ì  í‚¨ìŠ¤ì—ì„œ SSH ëª…ë ¹ì–´ ì „ì†¡ì„ í†µí•´ ë¹Œë“œí•œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë² ì´ìŠ¤ë¡œ ì»¨í…Œì´ë„ˆ ìƒì„±(ê¸°ë³¸ ë°°í¬ ì™„ë£Œ)****

ğŸ€ ****ì  í‚¨ìŠ¤ SSH ì—°ê²° ì„¤ì • (Publish over SSH)****

ì  í‚¨ìŠ¤ì—ì„œ AWSìœ¼ë¡œ SSH ëª…ë ¹ì–´ë¥¼ ì „ì†¡í•˜ë ¤ë©´ AWS ì¸ì¦ í‚¤(EC2 ìƒì„±í•  ë•Œ ì‚¬ìš©í•œ pem íŒŒì¼)ë¥¼ ë“±ë¡í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2045.png)

ì  í‚¨ìŠ¤ í™ˆí˜ì´ì§€ì—ì„œÂ `Jenkins ê´€ë¦¬`ë¥¼ í´ë¦­í•˜ê³ , ì´ì–´ì„œÂ `ì‹œìŠ¤í…œ ì„¤ì •`ì„ í´ë¦­í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2046.png)

ì‹œìŠ¤í…œ ì„¤ì • ì¹¸ì—ì„œ ìŠ¤í¬ë¡¤ì„ ì•„ë˜ë¡œ ì­‰ ë‚´ë¦¬ë©´Â `Public over SSH`Â í•­ëª©ì´ ìˆìŠµë‹ˆë‹¤. 

ì—¬ê¸°ì„œÂ `SSH Servers`Â ì¶”ê°€ ë²„íŠ¼ì„ ëˆŒëŸ¬ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2047.png)

- Name : ê·¸ëƒ¥ ì´ë¦„
- Hostname : EC2 IP
- Username : EC2 ì ‘ì† ê³„ì • ì´ë¦„

ìœ„ ë‚´ìš©ì„ ì‘ì„±í•˜ê³  ê³ ê¸‰ ë²„íŠ¼ì„ í´ë¦­í•´ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2048.png)

ë‹¤ë¥¸ ê±´ ê±´ë“œë¦¬ì§€ ì•Šê³ ,Â `Use password authentication, or use different key`Â ì²´í¬ë°•ìŠ¤ë¥¼ ì²´í¬í•´ì¤ë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ ì•„ë˜ì— ì‚¬ì§„ ì²˜ëŸ¼ Formì´ ìƒì„±ë©ë‹ˆë‹¤. ë‹¤ë¥¸ ê°’ì€ ì…ë ¥í•˜ì§€ ì•Šê³  Keyì—ë§Œ ê°’ì„ ì…ë ¥í•˜ê² ìŠµë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2049.png)

ë‚´ê°€ EC2ì—ì„œ ìƒì„±í–ˆë˜ í‚¤ í˜ì–´ pem íŒŒì¼(ì‹¸í”¼ì—ì„œ ë°›ì•˜ì„ ê²½ìš° ì‹¸í”¼ì—ì„œ ë°›ì€ pem íŒŒì¼)ì„ VSCodeë¡œ ì˜¤í”ˆí•´ì£¼ê² ìŠµë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2050.png)

Pem íŒŒì¼ì€ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì„±ìœ¼ë¡œ ë˜ì–´ìˆìŠµë‹ˆë‹¤. ì´ í…ìŠ¤íŠ¸ ë‚´ìš©ì„ ì „ì²´ ë³µì‚¬í•´ì¤ë‹ˆë‹¤.

ğŸ’£ **Begin RSA PRIVATE KEY, END RSA PRIVATE KEY ê¹Œì§€ ëª¨ë‘ ë³µì‚¬í•©ë‹ˆë‹¤.**

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2051.png)

ë³µì‚¬í•œ ë‚´ìš©ì„ Key ì¹¸ì— ë¶™ì—¬ë„£ê¸° í•´ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2052.png)

ì´í›„Â `Test Configuration`Â ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ Successê°€ ë‚˜ì˜¤ë©´ ì„±ê³µì…ë‹ˆë‹¤. 

í•˜ì§€ë§Œ ì—¬ê¸°ì„œëŠ” ì˜¤ë¥˜ê°€ ë‚˜ëŠ” ëª¨ìŠµì…ë‹ˆë‹¤.

ğŸ’£ í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µí•˜ì…¨ë‹¤ë©´ í•˜ìœ„ SSH ì—°ê²° ì˜¤ë¥˜ í•´ê²° ë°©ë²•ì€ skip í•˜ì…”ë„ ë©ë‹ˆë‹¤.

âœ¨Â ì´ ì˜¤ë¥˜ì— ëŒ€í•´ êµ¬ê¸€ë§ì„ ì¡°ê¸ˆ í•´ë³¸ ê²°ê³¼, ubuntu ë²„ì „ì´ 18.xx ë²„ì „ë³´ë‹¤ ë†’ì€ ê²½ìš°ì— pem í‚¤ë¡œ ì¸ì¦ì´ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ê²½ìš°ì—ëŠ” Pem í‚¤ë¡œ ì¸ì¦í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ, ubuntu ê³„ì •ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•˜ì—¬ ì—°ê²°í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´ í•´ê²°ë©ë‹ˆë‹¤.

ğŸ€ ****SSH ì—°ê²° ì˜¤ë¥˜ í•´ê²° ë°©ë²•****

ê°€ì¥ ë¨¼ì €, root ê³„ì • ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì¤ë‹ˆë‹¤. ëª…ë ¹ì–´ëŠ”Â `sudo passwd`ì…ë‹ˆë‹¤. 

ë¹„ë°€ë²ˆí˜¸ëŠ” ê³µê²©ì´ ì–´ë µê²Œ ë³µì¡í•˜ê²Œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2053.png)

ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í–ˆìœ¼ë©´Â `su` Â ëª…ë ¹ì–´ë¥¼ í†µí•´ root ê³„ì •ìœ¼ë¡œ ì ‘ì†í•©ë‹ˆë‹¤. 

ì´í›„,Â `passwd ubuntu`Â ëª…ë ¹ì–´ë¥¼ ì´ìš©í•´ ubuntu ê³„ì •ì˜ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì„¤ì •í•´ì¤ë‹ˆë‹¤. 

ì´ ì—­ì‹œ ë³µì¡í•œ íŒ¨ìŠ¤ì›Œë“œê°€ ì¢‹ìŠµë‹ˆë‹¤.(ì˜ëª»í•˜ë©´ í•´í‚¹ë‹¹í•¨)

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2054.png)

íŒ¨ìŠ¤ì›Œë“œ ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ, EC2ì—ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ id,pwì„ ì´ìš©í•œ ë¡œê·¸ì¸ì´ ì°¨ë‹¨ë˜ì–´ìˆìŠµë‹ˆë‹¤. ì´ì œ ì´ë¥¼ í•´ì œí•´ë³´ê² ìŠµë‹ˆë‹¤.

ê³„ì†í•´ì„œ root ê³„ì •ìœ¼ë¡œ ì ‘ì†ëœ ìƒíƒœì—ì„œÂ `vim /etc/ssh/sshd_config`Â ëª…ë ¹ì–´ë¥¼ í†µí•´Â `sshd_config`Â íŒŒì¼ì„ ì—´ì–´ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2055.png)

ê·¸ëŸ¬ë©´, ìœ„ ì‚¬ì§„ê³¼ ê°™ì´ vim í¸ì§‘ê¸°ê°€ ì—´ë¦½ë‹ˆë‹¤. ì´ ë•Œ, í‚¤ë³´ë“œë¥¼ ì´ìš©í•˜ì—¬ ì•„ë˜ë¡œ ì¡°ê¸ˆì”© ë‚´ë¦¬ë©´ì„œ ë°‘ì¤„ ì¹œ ë¶€ë¶„ì„ ì°¾ìŠµë‹ˆë‹¤.Â `PasswordAuthentication`ì„ noì—ì„œ yesìœ¼ë¡œ ë°”ê¾¸ê³ ,Â `esc :wq`Â ë¥¼ í†µí•´ì„œ ì €ì¥í•´ì¤ë‹ˆë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œÂ `service sshd reload`Â ëª…ë ¹ì–´ë¥¼ í†µí•´ sshdë¥¼ ì¬ì‹œì‘í•´ì¤ë‹ˆë‹¤.

ì´ì œ ë‹¤ì‹œ ì  í‚¨ìŠ¤ë¡œ ëŒì•„ì˜µë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2056.png)

ê¸°ì¡´ì— ìˆë˜Â `pem key`Â ë°ì´í„°ëŠ” ì§€ì›Œë²„ë¦½ë‹ˆë‹¤. 

ê·¸ë¦¬ê³ ,Â `Passphrase/Password`Â ì¹¸ì— ì•„ê¹Œ ì„¤ì •í–ˆë˜ ubuntu ê³„ì •ì˜ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•´ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2057.png)

ë‹¤ì‹œÂ `Test Configuration`ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ê² ìŠµë‹ˆë‹¤. 

ì´ì œëŠ” Successê°€ ëœ¨ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

SSH ì—°ê²°ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì €ì¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì €ì¥í•´ì£¼ê² ìŠµë‹ˆë‹¤.

ğŸ€ ****ì  í‚¨ìŠ¤ ë¹Œë“œ í›„ ì¡°ì¹˜ë¡œ SSH ëª…ë ¹ì–´ ì „ì†¡(EC2ì— ë„ì»¤ ì»¨í…Œì´ë„ˆ ìƒì„±)****

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2058.png)

ì  í‚¨ìŠ¤ í”„ë¡œì íŠ¸ í˜ì´ì§€ì—ì„œ, ë‹¤ì‹œ êµ¬ì„± ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2059.png)

ë¹Œë“œ í›„ ì¡°ì¹˜ íƒ­ì—ì„œ, ë¹Œë“œ í›„ ì¡°ì¹˜ ì¶”ê°€ë¥¼ í´ë¦­,Â `Send build artifacts over SSH`ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2060.png)

`Source files`ëŠ” ì»¨í…Œì´ë„ˆì—ì„œ awsë¡œ íŒŒì¼ì„ ì „ì†¡í•˜ëŠ” ë¶€ë¶„ì¸ë°, 

ì˜ë¯¸ê°€ ì—†ëŠ”ë°ë„ í•„ìˆ˜ ì…ë ¥ ì‚¬í•­ì´ê¸° ë•Œë¬¸ì— ì ë‹¹íˆ ì•„ë¬´ê±°ë‚˜ ì ì–´ì¤ë‹ˆë‹¤. 

ì¤‘ìš”í•œ ë¶€ë¶„ì€Â `Exec command`ë¶€ë¶„ì— ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ë³µì‚¬ ë¶™ì—¬ë„£ê¸° í•´ì¤ë‹ˆë‹¤.

```jsx
sudo docker load < /jenkins/images_tar/vue.tar
sudo docker load < /jenkins/images_tar/springboot.tar

if (sudo docker ps | grep "vue"); then sudo docker stop vue; fi
if (sudo docker ps | grep "springboot"); then sudo docker stop springboot; fi

sudo docker run -it -d --rm -p 80:80 -p 443:443 --name vue vue
echo "Run testproject_vue"
sudo docker run -it -d --rm -p 8080:8080  --name springboot springboot
echo "Run testproject"
```

ëª…ë ¹ì–´ ê°„ë‹¨ ì„¤ëª… (springbootì™€ ì¤‘ë³µë˜ëŠ” ëª…ë ¹ì–´ëŠ” í•œ ê°œë§Œ ì„¤ëª…)

- sudo docker load < /jenkins/images_tar/vue.tar : vue.tarì„ ì••ì¶• í•´ì œí•˜ì—¬ docker ì´ë¯¸ì§€ë¡œ ë“±ë¡
- if (sudo docker ps | grep "vueâ€); then sudo docker stop vue; fi : vue ì»¨í…Œì´ë„ˆê°€ ë§Œì•½ ë™ì‘ì¤‘ì´ë©´ stop ì‹œí‚¤ê¸°
- sudo docker run -it -d --rm -p 80:80 -p 443:443 --name vue vue : ì»¨í…Œì´ë„ˆ ìƒì„±í•˜ê¸° 80, 443 í¬íŠ¸ë¡œ ì—°ê²°, ì»¨í…Œì´ë„ˆ ì´ë¦„ì€ vueë¡œ

ì´í›„ ì €ì¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ì¤ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2061.png)

ì´ì œ ì§€ê¸ˆ ë¹Œë“œ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¹Œë“œí•´ì£¼ë©´.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2062.png)

ì½˜ì†”ì—ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆê³ .

ì„œë²„ì˜ 80í¬íŠ¸(HTTP)ì—ëŠ” Vueë¥¼

ğŸ’£ **í•˜ìœ„ ìº¡ì³ëŠ” ì°¸ê³  ì‚¬ì´íŠ¸ì˜ ìº¡ì³ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™€ vue ê°€ ì•„ë‹Œ react ì…ë‹ˆë‹¤.**

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2063.png)

8080í¬íŠ¸ì—ëŠ” SpringBootë¥¼ ì„œë¹„ìŠ¤í•˜ê²Œ ë©ë‹ˆë‹¤.

ğŸ’£ **í•˜ìœ„ ìº¡ì³ëŠ” ì°¸ê³  ì‚¬ì´íŠ¸ì˜ ìº¡ì³ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™€ SpringBoot ê°€ ì•„ë‹Œ Django ì…ë‹ˆë‹¤.**

ğŸ’£ **DBì™€ ì—°ê²° ì‹œí‚¤ì‹  í›„ Postmanìœ¼ë¡œ apiìš”ì²­ì„ ë³´ë‚´ì…”ì„œ 8080í¬íŠ¸ì— SpringBootê°€ ì œëŒ€ë¡œ ì—°ê²°ëëŠ”ì§€ ì²´í¬í•´ë³´ì‹œê¸¸ ê¶Œì¥í•©ë‹ˆë‹¤.**

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2064.png)

8080í¬íŠ¸ì—ëŠ” SpringBootë¥¼ ì„œë¹„ìŠ¤í•˜ê²Œ ë©ë‹ˆë‹¤.

ğŸ˜†Â ì—¬ê¸°ê¹Œì§€ ë„ì»¤ ì  í‚¨ìŠ¤ë¥¼ ì´ìš©í•œ CICD ìë™ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!

1. Gitlab Push Eventê°€ ì¼ì–´ë‚˜ë©´
2. Jenkinsì—ì„œ WebHookì„ í†µí•´ ìë™ìœ¼ë¡œ ë¹Œë“œë¥¼ ì‹¤í–‰
3. Jenkinsì—ì„œ ê°ê°ì˜ Vue(Nginx), SpringBoot í”„ë¡œì íŠ¸ ë‚´ë¶€ì˜ DockerFileë¥¼ ì´ìš©í•˜ì—¬ Dockerimage ìƒì„±(tar ì••ì¶•íŒŒì¼)
4. Jenkinsì—ì„œ SSH ì—°ê²°ì„ í†µí•´ AWSì— DockerContainer ìƒì„±
5. ì™¸ë¶€ì—ì„œ ì ‘ì† : ë„ì»¤ ì»¨í…Œì´ë„ˆì— ì˜¬ë¼ê°„ Nginxì—ì„œ Vueì™€ SpringBootë¥¼ ê°ê° '/', '/api'ë¡œ êµ¬ë¶„ì§€ì–´ ì—°ê²°

ì²˜ìŒ ì„¤ëª…í–ˆë˜ ì‘ë™ë°©ì‹ 1~5ì¤‘ì—ì„œ 4ë²ˆê¹Œì§€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒì€ ì •ë§ ë§ˆì§€ë§‰ ì„¤ì •ì¸ Nginx Proxy ì„¤ì •ì…ë‹ˆë‹¤.

## 1.3 ****Nginxë¥¼ í†µí•´ Vueì™€ SpringBoot ê²½ë¡œ ì„¤ì •****

ì´ ì‘ì—…ì„ êµ³ì´ í•´ì•¼í• ê¹Œ? ì‹¶ì€ ì‚¬ëŒë“¤ë„ ìˆì„ ê±°ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. nginx ì„¤ì •ì„ í•˜ì§€ ì•Šì•„ë„ ì„œë²„ëŠ” ì˜ ì„œë¹„ìŠ¤ ë˜ê³  ìˆê¸° ë•Œë¬¸ì´ì£ .

í•˜ì§€ë§Œ ì´ ê³¼ì •ì„ í•´ë†“ì§€ ì•Šìœ¼ë©´ Https ì„¤ì •ì„ í•  ë•Œ ë†’ì€ í™•ë¥ ë¡œ ë²ˆê±°ë¡œìš´ ì‘ì—…ì´ ì¶”ê°€ë¡œ ìƒê¸¸ ê²ƒì´ê³ , ë§Œì•½ í”„ë¡ íŠ¸ëŠ” Httpsì— ì„±ê³µí–ˆëŠ”ë° ë°±ì—”ë“œê°€ Https ì ìš©ì— ì‹¤íŒ¨í•œë‹¤ë©´ Https -> httpì˜ í¬ë¡œìŠ¤ ë„ë©”ì¸ ì˜¤ë¥˜ ë•Œë¬¸ì— ë°±ì—”ë“œ APIë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ëŠ” ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ë„ ìƒê¸°ê²Œ ë©ë‹ˆë‹¤.

ë”°ë¼ì„œ í•˜ë‚˜ì˜ ë„ë©”ì¸, í•œ ê°œì˜ Portì—ì„œ ë‘ ì„œë¹„ìŠ¤ë¥¼ êµ¬ë¶„ ì§“ëŠ” ë¶€ë¶„ì´ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.

ë§ˆì§€ë§‰ Nginx ì„¤ì • ë¶€ë¶„ì…ë‹ˆë‹¤. ì´ ê³¼ì •ì€, ê¸°ì¡´ ë·°ì™€ í¬íŠ¸ê°€ ë¶„ë¦¬ë˜ì–´ 8080 í¬íŠ¸ë¥¼ ì´ìš©í•´ì•¼ ì ‘ì† ê°€ëŠ¥í•œ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ë¥¼ 80 í¬íŠ¸ë¥¼ í†µí•´ ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ ë³€ê²½ì‹œì¼œì£¼ëŠ” ì‘ì—…ì…ë‹ˆë‹¤.

ğŸ€ ****nginx.conf íŒŒì¼ ìƒì„±****

EC2 Ubuntu ì½˜ì†”ì—ì„œÂ `cd /jenkins/workspace/deploytest/testproject_vue`Â ëª…ë ¹ìœ¼ë¡œ ë””ë ‰í† ë¦¬ë¥¼ ì´ë™í•©ë‹ˆë‹¤. ì´í›„Â `sudo mkdir deploy_conf`Â ëª…ë ¹ì–´ë¡œ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•˜ê³ Â `cd deploy_conf`ë¥¼ ì´ìš©í•´ ì´ë™í•´ì¤ë‹ˆë‹¤. ê·¸ í›„Â `sudo vim nginx.conf`Â ëª…ë ¹ì–´ë¡œÂ `nginx.conf`Â íŒŒì¼ì„ ìƒì„±í•˜ê³  í¸ì§‘ê¸°ë¡œ ì´ë™í•©ë‹ˆë‹¤.

nginx.conf íŒŒì¼

```jsx
upstream backend{
	ip_hash;
	server 172.31.62.140:8080;
}

server {
    listen       80;
    listen  [::]:80;
    server_name  localhost;

    #access_log  /var/log/nginx/host.access.log  main;

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }

	location /api/ {
        proxy_pass http://backend/;
        proxy_redirect     off;
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    #location ~ \.php$ {
    #    root           html;
    #    fastcgi_pass   127.0.0.1:9000;
    #    fastcgi_index  index.php;
    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
    #    include        fastcgi_params;
    #}

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    #location ~ /\.ht {
    #    deny  all;
    #}
}
```

âœ¨Â ìœ„ì—ì„œë¶€í„° 3ë²ˆì§¸ ì¤„, 172.31.62.140 ip ì£¼ì†ŒëŠ” EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ Private ip ì£¼ì†Œì…ë‹ˆë‹¤.

íŒŒì¼ì—ëŠ” ë‹¤ìŒ ë‚´ìš©ì„ ë³µì‚¬ ë¶™ì—¬ë„£ê¸° í•´ì¤ë‹ˆë‹¤.

nginx ì„¤ì • íŒŒì¼ì— ëŒ€í•´ ê°„ëµí•˜ê²Œ ì„¤ëª…í•˜ë©´,

upstream ì„ í†µí•´ì„œ backendë¥¼ ë¡œì»¬ ip:8080 ì£¼ì†Œì™€ ì—°ê²°ì‹œí‚¤ê³ ,

í•´ë‹¹ ì£¼ì†Œë¥¼ location /api ì— ì—°ê²°ì‹œì¼°ìŠµë‹ˆë‹¤.

ê¸°ì¡´ ë·° í”„ë¡œì íŠ¸ëŠ” location / ì— ì—°ê²°ë©ë‹ˆë‹¤.

ê²°ê³¼ì ìœ¼ë¡œ ê³µì¸ipì£¼ì†Œ/apië¡œ ìš”ì²­ì„ í•˜ë©´ Nginxì—ì„œ ìŠ¤í”„ë§ë¶€íŠ¸ì„œë²„ë¡œ ì—°ê²°ì„ ì‹œì¼œì£¼ê²Œë©ë‹ˆë‹¤.

nginxì™€ ìŠ¤í”„ë§ë¶€íŠ¸ ì„œë²„ ì‚¬ì´ì˜ í†µì‹ ì€ ë¡œì»¬ì—ì„œ ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸ì— ê³µì¸ IPë¥¼ ë“±ë¡í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ ê°€ì¥ ì²˜ìŒì—ì— EC2ì— ì ‘ê·¼ í—ˆìš©í–ˆë˜ 8080í¬íŠ¸ë¥¼ ë§‰ì•„ë²„ë¦¬ë©´, ì™¸ë¶€ì—ì„œ ìŠ¤í”„ë§ë¶€íŠ¸ ì„œë²„ë¡œëŠ” ì§ì ‘ ì ‘ì†ì„ ëª»í•˜ê²Œ ë˜ê³ , nginx(80í¬íŠ¸)ë¥¼ í†µí•´ì„œë§Œ ì ‘ì†í•  ìˆ˜ ìˆê²Œë©ë‹ˆë‹¤.

`nginx.conf`Â íŒŒì¼ ì‘ì„±ì„ ë§ˆì³¤ë‹¤ë©´Â `esc, :wq`Â ë¥¼ í†µí•´ íŒŒì¼ì„ ì €ì¥í•´ì¤ë‹ˆë‹¤.

ğŸ€ ë„ì»¤íŒŒì¼ ìˆ˜ì •( í”„ë¡ íŠ¸ ë„ì»¤ íŒŒì¼)

```jsx
FROM node:16.15.0 as build-stage
WORKDIR /var/jenkins_home/workspace/deploytest/testproject_vue
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
FROM nginx:stable-alpine as production-stage

COPY --from=build-stage /var/jenkins_home/workspace/deploytest/testproject_vue/build /usr/share/nginx/html
COPY --from=build-stage /var/jenkins_home/workspace/deploytest/testproject_vue/deploy_conf/nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g","daemon off;"]
```

ì•ì„œ DockerFile ë§Œë“¤ ë•Œ, #ìœ¼ë¡œ ì£¼ì„ì²˜ë¦¬ í–ˆë˜ ë¶€ë¶„ì„ í•´ì œí•´ì¤ë‹ˆë‹¤. ì´ ë¶€ë¶„ì€ ë°©ê¸ˆ ìƒì„±í•œ nginx ì„¤ì • íŒŒì¼ì„ nginx ì´ë¯¸ì§€ë¡œ ì˜®ê¸°ëŠ” ëª…ë ¹ì–´ì˜€ìŠµë‹ˆë‹¤.

ğŸ€ ****ìµœì¢… ë¹Œë“œ í…ŒìŠ¤íŠ¸****

ë„ì»¤íŒŒì¼ì´ ìˆ˜ì •ì‚¬í•­ì„ ë°˜ì˜ì‹œí‚¤ë ¤ë©´, gitlabì— Push í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤! ìµœì¢…ì ìœ¼ë¡œ ëª¨ë“  ê¸°ëŠ¥ì´ ì˜ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ìˆëŠ” ê¸°íšŒê°€ ë˜ê² ë„¤ìš”.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2065.png)

ìˆ˜ì •ì‚¬í•­ì„Â `master Branch`ì—Â `Push`í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2066.png)

`jenkins`ì—ì„œÂ `push trigger`ë¥¼ ë°›ì•„Â `build`ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2067.png)

ë¹Œë“œê°€ ì™„ë£Œëœ í›„,Â `http://ê³µì¸ip/`Â ë¡œ ì ‘ì†í•˜ë©´ Vueê°€

ğŸ’£ **ìº¡ì³ê°€ ë‹¤ë¥¸ ì´ìœ ëŠ” ì œê°€ ì°¸ê³ í•œ ì‚¬ì´íŠ¸ì—ì„œ ì´ë¯¸ì§€ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¨ ê²ƒì´ë¼ ê·¸ë ‡ìŠµë‹ˆë‹¤.**
ğŸ’£  **ì‚¬ìš©í•˜ì‹œëŠ” ë¶„ì˜ í”„ë¡ íŠ¸ í™”ë©´ì´ ë‚˜ì˜¤ë©´ ì„±ê³µì…ë‹ˆë‹¤.**

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2068.png)

ã…‚`http://ê³µì¸ip/api`Â ë¡œ ì ‘ì†í•˜ë©´ SpringBootê°€ ì‹¤í–‰ë˜ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![Untitled](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%208517c03771dc466cbe472774aea3bc4b/Untitled%2069.png)

EC2 ì¸ë°”ìš´ë“œê·œì¹™ì—ì„œ 8080í¬íŠ¸ ì ‘ì†ì„ ì°¨ë‹¨í–ˆìŠµë‹ˆë‹¤.Â `http://ê³µì¸ip:8080`
Â ë”ì´ìƒ 8080í¬íŠ¸ë¡œëŠ” ì ‘ì†ì´ ë˜ì§€ ì•Šë„¤ìš”.

## 1.5 SSL ì„¤ì •

**ì°¸ê³ ì‚¬ì´íŠ¸**

[SSLì„¤ì •](https://sinawi.tistory.com/410?category=879243)

3ê°œì›” ì¸ì¦ì„œë¥¼ ë§Œë“¤ì–´ ì£¼ëŠ” í™•ì¥ í”„ë¡œê·¸ë¨ certbotì„ ì´ìš©í•´ ì§„í–‰í•©ë‹ˆë‹¤.

SSL ì¸ì¦ì„œ ë°œê¸‰ ë°©ë²•ì—ëŠ” 3~4ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

1. standalone
    
    ***ì‚¬ì´íŠ¸ ì‘ë™ì„ ë©ˆì¶”ê³  ì´ ì‚¬ì´íŠ¸ì˜ ë„¤í¬ì›Œí‚¹ì„ ì´ìš©í•´ ì‚¬ì´íŠ¸ ìœ íš¨ì„±ì„ í™•ì¸í•´ Letâ€™s Encrypt SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰í•˜ëŠ” ë°©ì‹***
    
    ***. 80í¬íŠ¸ë¡œ ê°€ìƒ staandalone ì›¹ì„œë²„ë¥¼ ë„ì›Œ ì¸ì¦ì„œë¥¼ ë°œê¸‰***
    
    ***. ì´ ë°©ì‹ì€ ë™ì‹œì— ì—¬ëŸ¬ ë„ë©”ì¸ì„ ë°œê¸‰ ë°›ì„ ìˆ˜ ìˆìŒ***
    
    ***. ê·¸ë ‡ì§€ë§Œ ì¸ì¦ì„œ ë°œê¸‰ ì „ì— Nginxë¥¼ ì¤‘ë‹¨í•˜ê³  ë°œê¸‰ ì™„ë£Œ í›„ ë‹¤ì‹œ Nginxë¥¼ ì‹œì‘í•´ì•¼ í•¨***
    
2. webhook
    
    ***ì‚¬ì´íŠ¸ ë””ë ‰í† ë¦¬ ë‚´ì— ì¸ì¦ì„œ ìœ íš¨ì„±ì„ í™•ì¸í•  ìˆ˜ ìˆëŠ” íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ì¸ì¦ì„œë¥¼ ë°œê¸‰í•˜ëŠ” ë°©ë²•***
    
    ***. ì‹¤ì œ ì‘ë™í•˜ê³  ìˆëŠ” ì›¹ì„œë²„ì˜ íŠ¹ì • ë°ë ‰í† ë¦¬ì˜ íŠ¹ì • íŒŒì¼ ì“°ê¸° ì‘ì—…ì„ í†µí•´ì„œ ì¸ì¦***
    
    ***. ì´ ë°©ì‹ì˜ ì¥ì ì€ nginxë¥¼ ì¤‘ë‹¨ì‹œí‚¬ í•„ìš”ê°€ ì—†ìŒ.***
    
    ***. ì´ ë°©ë²•ì˜ ë‹¨ì ì€ ì¸ì¦ ëª…ë ¹ì— í•˜ë‚˜ì˜ ë„ë©”ì¸ ì¸ì¦ì„œë§Œ ë°œê¸‰ ê°€ëŠ¥***
    
3. DNS
    
    ***ë„ë©”ì¸ì„ ì¿¼ë¦¬í•´ í™•ì¸ë˜ëŠ” TXT ë ˆì½”ë“œë¡œ ì‚¬ì´íŠ¸ ìœ íš¨ì„±ì„ í™•ì¸í•˜ëŠ” ë°©ë²•***
    
    ***. ì™€ì¼ë“œ ì¹´ë“œ ë°©ì‹ìœ¼ë¡œ ì¸ì¦ì„œë¥¼ ë°œê¸‰ ê°€ëŠ¥***
    
    ***. ì´ ë°©ë²•ì€ ë‹¹ì—°í•˜ê²Œë„ ì„œë²„ ê´€ë¦¬ìê°€ ë„ë©”ì¸ DNSë¥¼ ê´€ë¦¬/ìˆ˜ì •í•  ìˆ˜ ìˆì–´ì•¼ í•˜ë©°***
    
    ***. ì¸ì¦ì„œ ê°±ì‹  ì‹œë§ˆë‹¤ DNSì—ì„œ TXTê°’ì„ ë³€ê²½í•´ì•¼ í•˜ë¯€ë¡œ***
    
    ***ì™¸ë¶€ì—ì„œ TXT ë ˆì½”ë“œë¥¼ ì…ë ¥í•  ìˆ˜ ìˆë„ë¡ DNSê°€ APIë¥¼ ì œê³µí•˜ëŠ” ê²½ìš°ë§Œ ê°±ì‹  ê³¼ì •ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬*** 
    
4. ì›¹ì„œë²„
    
    ***. Nginxë‚˜ ì•„íŒŒì¹˜ì™€ ê°™ì€ ì›¹ì„œë²„ì—ì„œ ì§ì ‘ SSL ì¸ì¦ì„ ì‹¤ì‹œí•˜ê³  ì›¹ì„œë²„ì— ë§ëŠ” SSLì„¸íŒ…ê°’ì„ ë¶€ì—¬***
    
    ***. ë°œê¸‰ì´ë‚˜ ê°±ì‹ ì„ ìœ„í•´ ì›¹ì„œë²„ë¥¼ ì¤‘ë‹¨ì‹œí‚¬ í•„ìš”ê°€ ì—†ìŒ***
    
    ***. ì¸ì¦ì„œ ê°±ì‹  ì‹œ ìƒí™©ì— ë§ê²Œ ì„¸íŒ…ì„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸***
    
    ***. ì‚¬ìš©ìê°€ ì„¸íŒ…ì„ ë³€ê²½í•  ìˆ˜ ìˆì§€ë§Œ ìë™ ì—…ë°ì´íŠ¸ ì‹œ ë°˜ì˜ë˜ì§€ëŠ” ì•ŠìŒ***
    

ì €ëŠ” standalone ë°©ë²•ìœ¼ë¡œ ì¸ì¦ì„œë¥¼ ë°œê¸‰ ë°›ì•„ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.

## 1.5.1 **Certbot container ìƒì„± ë° ì¸ì¦ì„œ ë°œê¸‰**

```jsx
 cd
 sudo mkdir certbot
 cd certbot
 sudo mkdir conf www logs
 
 sudo docker pull certbot/certbot
 sudo docker run -it --rm --name certbot -p 80:80\
             -v "/home/ubuntu/certbot/conf:/etc/letsencrypt" \
             -v "/home/ubuntu/certbot/log:/var/log/letsencrypt" \
             -v "/home/ubuntu/certbot/www:/var/www/certbot" \
             certbot/certbot certonly
```

íŒ¨í‚¤ì§€ ì„¤ëª…

cd : ê¸°ë³¸ ë””ë ‰í† ë¦¬(í´ë”) ì´ë™

sudo mkdir certbot : ì´ë¦„ì´ certbot ì¸ ë””ë ‰í† ë¦¬(í´ë”) ìƒì„±

cd certbot : certbot í´ë” ì•ˆìœ¼ë¡œ ì´ë™

sudo mkdir conf www logs : ì´ë¦„ì´ conf, www, logs ì¸ ë””ë ‰í† ë¦¬(í´ë”) ìƒì„±

sudo docker pull certbot/certbot : certbot ì»¨í…Œì´ë„ˆë¥¼ pull ë°›ëŠ”ë‹¤.

sudo docker run -it â€”rm â€”name certbot -p 80:80 \ : ì»¨í…Œì´ë„ˆ ì´ë¦„ì´ certbotì¸ ì»¨í…Œì´ë„ˆë¥¼ í¬íŠ¸í¬ì›Œë”©(ì™¸ë¶€ ì ‘ê·¼ í¬íŠ¸ 80: ë‚´ë¶€ ì ‘ê·¼ í¬íŠ¸ 80)í•˜ì—¬ ì‹¤í–‰ì‹œí‚¨ë‹¤.

-v :/home/ubuntu/certbot/conf:/etc/letsencryptâ€ \ : ë³¼ë¥¨ ì„¤ì • ( ë§¤í•‘ ) , ë‚˜ë¨¸ì§€ëŠ” ìƒëµ

certbot/certbot certonly : certbot/certbot ì´ë¦„ìœ¼ë¡œ ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“¤ì–´ ì‹¤í–‰

### SSL ì¸ì¦ì„œ ë°œê¸‰ ê³¼ì •

**ğŸ’£ í•„ë…!!!!!!!!!!**

**ğŸ’£ ì¸ì¦ì„œ ë°œê¸‰ì„ ì¼ì • ê¸°ê°„ ì•ˆì— 5íšŒ ì´ìƒ í•œë‹¤ë©´ í•´ë‹¹ ë„ë©”ì¸ì— ëŒ€í•œ ì¸ì¦ì„œ ë°œê¸‰ì´ ë§‰í™ë‹ˆë‹¤.**

**ğŸ’£ ë°œê¸‰ì´ ì œëŒ€ë¡œ ì´ë£¨ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤ë©´ ì§ì ‘ ì°¾ì•„ë³´ì‹œê³  ì¶©ë¶„íˆ ìˆ™ì§€ í›„ ì§„í–‰í•˜ì‹œê¸¸ ê¶Œì¥ë“œë¦½ë‹ˆë‹¤.**

**ì¸ì¦ì„œ ë°œê¸‰ ê³¼ì •**

- standalone,Â agree,Â no,Â <domain_name>Â ìœ¼ë¡œ ì‘ì„±í•˜ë©´ ì¸ì¦ì„œê°€ ë°œê¸‰ëœë‹¤.
- domain_nameì€ ì‚¬ìš©í•˜ë ¤ëŠ” ì‹¤ì œ ë„ë©”ì¸ì´ì–´ì•¼ í•œë‹¤.

Saving debug log to /var/log/letsencrypt/letsencrypt.log

How would you like to authenticate with the ACME CA?

-Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -

1: Spin up a temporary webserver (standalone)

2: Place filesÂ inÂ webroot directory (webroot)

-Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -

Select the appropriate number [1-2]Â thenÂ [enter] (pressÂ 'c'Â to cancel):Â 1

Enter email address (usedÂ forÂ urgent renewal and security notices)

(Enter 'c' to cancel): <<email>> 

-Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -

Please read the Terms of Service at

. You must

agreeÂ inÂ order to register with the ACME server. Do you agree?

-Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -

(Y)es/(N)o: y 

-Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -

Would you be willing, once your first certificate is successfully issued, to

share your email address with the Electronic Frontier Foundation, a founding

partner of the Let's Encrypt project and the non-profit organization that

develops Certbot? We'd like to send you email about our work encrypting the web,

EFF news, campaigns, and ways to support digital freedom.

-Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -

(Y)es/(N)o: n // ê´‘ê³  ìˆ˜ì‹  ì—¬ë¶€

Account registered.

Please enter the domain name(s) you would like on your certificate (comma and/or

space separated) (Enter 'c' to cancel): <<domain_name>>

Requesting a certificate for <<domain_name>>

Successfully received certificate.

Certificate is saved at: /etc/letsencrypt/live/<<domain_name>>/fullchain.pem

Key is saved at: Â  Â  Â  Â  /etc/letsencrypt/live/<<domain_name>>/privkey.pem

This certificate expires onÂ 2021-12-25.

These files will be updated when the certificate renews.

NEXT STEPS:

-Â The certificate will need to be renewed before it expires. Certbot can automatically renew the certificateÂ inÂ the background, but you may need to take steps to enable that functionality. See Â forÂ instructions.

-Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -Â -

If you like Certbot, please consider supporting our work by:

* Donating to ISRG / Let's Encrypt:

* Donating to EFF:

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

### 1.5.2 **jenkins pipeline ìˆ˜ì •**

```jsx
sudo docker load < /jenkins/images_tar/vue.tar
sudo docker load < /jenkins/images_tar/springboot.tar

if (sudo docker ps | grep "vue"); then sudo docker stop vue; fi
if (sudo docker ps | grep "springboot"); then sudo docker stop springboot; fi

sudo docker run -it -d --rm -p 80:80 -p 443:443 -v /home/ubuntu/certbot/conf:/etc/letsencrypt/ -v /home/ubuntu/certbot/www:/var/www/certbot --name vue vue
echo "Run FE"
sudo docker run -it -d --rm -p 8080:8080 --name springboot springboot
echo "Run BE"
```

ì¸ì¦ì„œë¥¼ ì¶”ê°€í•´ì•¼í•˜ë¯€ë¡œ ë„ì»¤ ì»¨í…Œì´ë„ˆì™€ certbot ì¸ì¦ì„œê°€ ìˆëŠ” ë””ë ‰í† ë¦¬ë¥¼ ì—°ê²°í•œë‹¤.

(í˜¸ìŠ¤íŠ¸ì™€ ì»¨í…Œì´ë„ˆ ë³¼ë¥¨ì„ ì—°ê²°í•œë‹¤)

### 1.5.3 **Nginx ì„¤ì •(conf.d/default.conf)**

ìš°ë¶„íˆ¬ ì„œë²„

```jsx
cd
cd ../..
cd jenkins/workspace/deploytest/testproject_vue/deploy_conf/
sudo vim nginx.conf
```

nginx.conf íŒŒì¼

- httpì˜ ê¸°ë³¸ í¬íŠ¸ëŠ”Â `80`ì´ë‹¤.
- httpsì˜ ê¸°ë³¸ í¬íŠ¸ëŠ”Â `443`ì´ë‹¤.
- https ì„¤ì •ì€ 80í¬íŠ¸(http)ë¡œ ë“¤ì–´ì˜¤ë©´ 443(https)í¬íŠ¸ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ ì‹œì¼°ë‹¤.
- ê·¸ë¦¬ê³  ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œë„ ì„¤ì •í–ˆë‹¤.Â /apië¡œ ë“¤ì–´ì˜¤ë©´ ë°±ì—”ë“œì„œë²„ì— ì—°ê²°í•˜ì˜€ë‹¤.

```jsx
upstream backend{
        ip_hash;
        server 172.31.62.140:8080;
}

map $http_upgrade $connection_upgrade {
        default upgrade;
        ..      close;
}

server {
        listen 80;
        server_name <<domain_address>>;
        location / {
                return 301 https://$host$request_uri;
        }
}

server {

    listen       443 ssl;
    server_name <<domain_address>>;

    #access_log  /var/log/nginx/host.access.log  main;

    ssl_certificate /etc/letsencrypt/live/<<domain_address>>/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/<<domain_address>>/privkey.pem;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2 SSLv3;
    ssl_ciphers ALL;

    location / {
     root /usr/share/nginx/html;
     index index.html index.htm
     proxy_redirect off;
     charset utf-8;
     try_files $uri $uri/ /index.html;
		
		 proxy_http_version 1.1;
     proxy_set_header Upgrade $http_upgrade;
     proxy_set_header Connection "upgrade";
     proxy_set_header Host $host;
     proxy_set_header X-Real-IP $remote_addr;
     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
     proxy_set_header X-Forwarded-Proto $scheme;
     proxy_set_header X-Nginx-Proxy true;
   }

   location /api/ {
     rewrite ^/api/(.*|$) /$1  break;
     proxy_pass http://backend/;
     proxy_redirect off;
     charset utf-8;

     proxy_http_version 1.1;
     proxy_set_header Upgrade $http_upgrade;
     proxy_set_header Connection $connection_upgrade;
     proxy_set_header Host $http_host;
     proxy_set_header X-Real-IP $remote_addr;
     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
     proxy_set_header X-Forwarded-Proto $scheme;
     proxy_set_header X-Nginx-Proxy true;
   }

    #error_page  404              /404.html;
		# redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    #location ~ \.php$ {
    #    root           html;
    #    fastcgi_pass   127.0.0.1:9000;
    #    fastcgi_index  index.php;
    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
    #    include        fastcgi_params;
    #}

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    #location ~ /\.ht {
    #    deny  all;
    #}
}
```

âœ¨ upstreamì€Â [proxy_pass](https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass)Â ,Â [fastcgi_pass](https://nginx.org/en/docs/http/ngx_http_fastcgi_module.html#fastcgi_pass)Â ,Â [uwsgi_pass](https://nginx.org/en/docs/http/ngx_http_uwsgi_module.html#uwsgi_pass)Â ,Â [scgi_pass](https://nginx.org/en/docs/http/ngx_http_scgi_module.html#scgi_pass)Â ,Â [memcached_pass](https://nginx.org/en/docs/http/ngx_http_memcached_module.html#memcached_pass)Â ë°Â [grpc_pass](https://nginx.org/en/docs/http/ngx_http_grpc_module.html#grpc_pass)
ì˜ ì§€ì‹œìì— ëŒ€í•´ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” ì„œë²„ ê·¸ë£¹ì„ ì •ì˜ í•˜ëŠ”ë° ì‚¬ìš©í•©ë‹ˆë‹¤.Â 

upstream ì„ í†µí•´ì„œ backendë¥¼ ë¡œì»¬ ip:8080 ì£¼ì†Œì™€ ì—°ê²°ì‹œí‚µë‹ˆë‹¤.

(ê·¸ë¦¬ê³  nginxê°€ ë°›ì•˜ë˜ ë¦¬í€˜ìŠ¤íŠ¸ë¥¼ í•´ë‹¹ ì„œë²„ì— ë„˜ê¹€)

ìœ„ì—ì„œë¶€í„° 3ë²ˆì§¸ ì¤„, 172.31.62.140 ip ì£¼ì†ŒëŠ” EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ Private ip ì£¼ì†Œì…ë‹ˆë‹¤.

11~17ë²ˆì§¸ ì¤„ : 

ì´ëŠ” reverse proxy ì„œë²„ëŠ” 80ë²ˆ í¬íŠ¸ë¥¼ listení•˜ê³  server_nameì€ domain_address ë¡œ ì§€ì •í–ˆë‹¤.

(**ë„ë©”ì¸ìœ¼ë¡œ ì§€ì •í•  ê²½ìš° í¬íŠ¸ëŠ” ê°™ì§€ë§Œ ë„ë©”ì¸ê¸°ì¤€ìœ¼ë¡œ proxy_passë„ ê°€ëŠ¥í•´ì§„ë‹¤)**

proxy_passì„¤ì •ì„ ë³´ë©´Â `/`ë¡œ ë“¤ì–´ì˜¬ê²½ìš° 

ìœ„ì—ì„œ ì •ì˜í•œ upstream docker-nginx(172.31.62.140 containerì˜ 8080í¬íŠ¸)ë¡œ proxyí•œë‹¤.

https ê²½ë¡œë¡œ ì ‘ê·¼í•œë‹¤ë©´ https ê¸°ë³¸ í¬íŠ¸ì¸ 443ìœ¼ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.

í”„ë¡ íŠ¸ëŠ” / ê²½ë¡œë¡œ, ë°±ì€ /api ë¡œ ìš”ì²­í•˜ê¸°ë¡œ ì•½ì†ë¼ìˆë‹¤ëŠ” ì „ì œë¡œ 

/ ë¡œ ê²½ë¡œê°€ ë“¤ì–´ì˜¤ë©´ í”„ë¡ íŠ¸ ì°½ìœ¼ë¡œ ì—°ê²°ë˜ê³ , /api ê²½ë¡œë¡œ ë“¤ì–´ì˜¤ë©´ upstream ê²½ë¡œë¡œ ì—°ê²°ë©ë‹ˆë‹¤.

`nginx.conf`Â íŒŒì¼ ì‘ì„±ì„ ë§ˆì³¤ë‹¤ë©´Â `esc, :wq`Â ë¥¼ í†µí•´ íŒŒì¼ì„ ì €ì¥í•´ì¤ë‹ˆë‹¤.