# 도커 이미지

Created: 2022년 9월 25일 오후 2:35
Tags: Docker
분류: Server
작성자: 창모 연

데비안 운영체제에서 apt-get install을 실행하면 apt 레포지토리에서 패키지를 내려받고

레드햇 운영체제에서 yum install을 실행하면 yum 레포지토리에서 패키지를 내려받는다.

이와 같이 도커는 도커 허브라는 중앙 이미지 저장소에서 이미지를 내려받는다.

### 이미지 검색 방법

1. 도커 허브 사이트 방문
2. 도커 엔진에서 docker search 명령어 사용 ex) docker search ubuntu

### 생성된 이미지 확인

docker images

### 사용 중이지 않은 댕글링 이미지(<none>) 삭제 방법

docker image prune

💣 이미지를 삭제했다고 해당 이미지의 레이어 파일이 항상 삭제되진 않습니다.

💣 해당 이미지를 사용하고 있는 다른 이미지가 있다면 실제 이미지 파일을 삭제하지 않고 레이어에 부여된 이름만 삭제

💣 삭제되는 이미지의 부모 이미지가 존재하지 않아야만 해당 이미지 파일이 실제 삭제됩니다.

### 이미지 추출 ( 좋은 방법은 아니라고 합니다 )

도커 이미지를 별도로 저장하거나 옮기는 등 필요에 따라 이미지를 단일 바이너리 파일로 저장해야 할 때 이용

ex) docker save -o [추출될 파일명] ubuntu:14.04

ex) docker save -o ubuntu_14_04.tar ubuntu:14.04

추출된 이미지는  load 명령어로 도커에 다시 로드할 수 있음

save 명령어로 추출된 이미지는 이미지의 모든 메타데이터를 포함하기 때문에 load 명령어로 로드하면

이전의 이미지와 완전한 동일한 이미지가 도커 엔진에 생성

(현 프로젝트 젠킨스에 save, load 이용 ⇒ 많은 container, image 가 생성됨 ⇒ 삭제가 안됨 ⇒ 추후 프로젝트엔 적용X )

ex) docker load -i ubuntu_14_04.tar

### 이미지 배포

1. 도커 허브 이미지 저장소 이용
    1. public : 다른 사람도 이용 가능
    2. private : 접근 권한이 있는 계정만 이용 가능, 1개만 무료 그 이상 유료
2. 도커 사설 레지스토리 사용
    1. 사용자가 직접 이미지 저장소를 만듬 ( 회사 내부망 등)

```jsx
읽고 있는 책이 갑자기 도커 사설 레지스토리 설명하다가 재시작 옵션(4가지)을 알려줘서 추가
1. always
ex) docker run -d --restart=always
컨테이너가 정지될 때마다 다시 시작하도록 설정, 도커 호스트, 엔진을 재시작하면 컨테이너도 함께 재시작

2. on-failure:5
ex) docker run -d --restart=on-failure:5
컨테이너 종료 코드가 0이 아닐 때 컨테이너 재시작을 5번까지 시도

3. unless-stopped
ex) docker run -d --restart=unless-stopped
컨테이너를 stop 명령어로 정지했다면 도커 호스트, 엔진을 재시작해도 컨테이너가 시작되지 않도록 설정(나머지 경우엔 재시작)

4. no
ex) docker run -d --restart=no
컨테이너를 재시작 시키지 않는다.
```

### 도커 이미지 구성

도커 이미지는 이미지에 대한 정보를 저장하는 매니페스토와 실제로 이미지에 레이어 파일을 저장하는 바이너리 파일

매니페스토와 각 레이어에 해당하는 파일은 고유한 ID(다이제스트) 값을 가짐